!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ResizeImage=e()}(this,function(){"use strict";function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:240,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff";this.el=document.createElement("canvas"),this.ctx=this.el.getContext("2d"),this.el.width=t,this.el.height=e,this.ctx.fillStyle=n,this.ctx.fillRect(0,0,t,e)}function e(t){return new Promise(function(e,n){if(t){var o=new Image;o.onload=function(t){e(o)},o.onerror=function(t){n(t)},o.setAttribute("crossOrigin","anonymous"),o.src=t}else n(new Error("no src"))})}function n(e,n,o){return new Promise(function(r){function i(n,o){var u=Math.pow(2,n),a=new t(e.width*u,e.height*u,e.bgColor);a.ctx.drawImage(o,0,0,.5*o.width,.5*o.height),n>0?i(n-1,a.el):r(a.el)}i(n-1,o)})}function o(e){(e=Object.assign({},f,e)).reSample=Math.min(4,e.reSample),e.reSample=Math.max(0,e.reSample);var o=Math.pow(2,e.reSample);return new Promise(function(r,i){try{var u=new t(e.width*o,e.height*o,e.bgColor);u.ctx.drawImage(e.canvas,e.cx,e.cy,e.cw,e.ch,e.dx*o,e.dy*o,e.dw*o,e.dh*o),e.reSample>0?n(e,e.reSample,u.el).then(r):r(u.el)}catch(t){i(t)}})}function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.75;return e=u(e),new Promise(function(o,r){try{o(t.toDataURL(e,n))}catch(t){r(t)}})}function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.75;return e=u(e),new Promise(function(o,r){try{o(a(t.toDataURL(e,n)))}catch(t){r(t)}})}function u(t){var e=null;switch(t){case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;default:e=t}return e}function a(t){for(var e=atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),r=new Uint8Array(o),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);var u=new DataView(o);return new Blob([u],{type:n})}function c(t,e,n,o){var r=t,i=e;return n&&o&&(n>o?o=null:n=null),n?(r=n,i=e*(n/t)):o&&(r=t*(o/e),i=o),{width:parseInt(r),height:parseInt(i)}}var h={quality:.75,format:"jpg",outputType:"base64",width:320,height:null,reSample:2,bgColor:"#ffffff",saveExif:!1},f={canvas:null,reSample:2,width:320,height:240,cx:0,cy:0,cw:0,ch:0,dx:0,dy:0,dw:0,dh:0,bgColor:"#ffffff"},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(t){this.value=t}function e(e){function n(r,i){try{var u=e[r](i),a=u.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(u.done?"return":"normal",u.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?n(r.key,r.arg):i=null}var r,i;this._invoke=function(t,e){return new Promise(function(o,u){var a={key:t,arg:e,resolve:o,reject:u,next:null};i?i=i.next=a:(r=i=a,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();return function(n){function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return Object.keys(t).forEach(function(o){n[o]=e[o]||t[o]}),n.width=Number(n.width),n.height=Number(n.height),n.quality=Number(n.quality),n.reSample=Number(n.reSample),n}function a(n,o){var r=null;return new Promise(function(i,u){e(n).then(function(e){(r=new t(e.width,e.height,o.bgColor)).ctx.drawImage(e,0,0),i(r.el)},function(t){u(t)})})}function f(e,n){var o=null;return new Promise(function(r,i){function u(t){i(t)}var a=new FileReader;a.onload=function(e){var i=new Image;i.onload=function(){(o=new t(i.width,i.height,n.bgColor)).ctx.drawImage(i,0,0),r(o.el)},i.onerror=u,i.src=e.target.result},a.onerror=u,a.readAsDataURL(e.files[0])})}this.options=u(h,n),this.play=function(t){var e=this;return new Promise(function(n,o){e.get(t).then(function(t){return e.resize(t)}).then(function(t){return e.output(t)}).then(function(t){return n(t)}).catch(function(t){return o(t)})})},this.get=function(t,e){return e=e?u(this.options,e):this.options,new Promise(function(n,o){"string"==typeof t?n(a(t,e)):"object"===(void 0===t?"undefined":s(t))?n(f(t,e)):o(new Error("Not found source"))})},this.resize=function(t,e){return e=e?u(this.options,e):this.options,new Promise(function(n,r){var i=c(t.width,t.height,e.width,e.height);o({canvas:t,reSample:e.reSample,width:i.width,height:i.height,cx:0,cy:0,cw:t.width,ch:t.height,dx:0,dy:0,dw:i.width,dh:i.height,bgColor:e.bgColor}).then(n).catch(r)})},this.output=function(t,e){return e=e?u(this.options,e):this.options,new Promise(function(n,o){switch(e.outputType){case"base64":r(t,e.format,e.quality).then(n).catch(o);break;case"blob":i(t,e.format,e.quality).then(n).catch(o);break;case"canvas":default:n(t)}})},this.updateOptions=function(t){return this.options=u(this.options,t),this}}});
